<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>五區舌診小測驗</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
        .zone { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        textarea { width: 100%; height: 60px; }
        img.preview { max-width: 300px; margin-top: 10px; display: none; }
    </style>
</head>
<body>
    <h1>五區舌診互動小測驗</h1>

    <form method="POST" enctype="multipart/form-data">
        <p>請直接拍照或上傳舌頭圖片並填寫你對五個區域的觀察與判斷：</p>
        <input type="file" name="image" accept="image/*" capture="environment" onchange="previewImage(event)" required><br><br>

        <img id="preview" class="preview" src="#" alt="預覽圖片">

        {% for zone in ["心", "肝", "脾", "肺", "腎"] %}
            <div class="zone">
                <strong>{{ zone }} 區：</strong><br>
                <textarea name="{{ zone }}">{{ user_answers.get(zone, "") }}</textarea>
            </div>
        {% endfor %}

        <button type="submit">送出分析與對照</button>
    </form>

    {% if filename %}
        <hr>
        <h2>🖼️ 舌頭區域對照圖：</h2>
        <img src="{{ url_for('static', filename='tongue_map.png') }}" style="width: 300px;">
    {% endif %}

    {% if result %}
        <hr>
        <h2>🔍 分析結果與比對</h2>
        {% for zone in result %}
            <div class="zone">
                <strong>{{ zone }} 區</strong><br>
                🧠 <u>你輸入的觀察：</u> {{ user_answers[zone] }}<br>
                🧪 <u>系統診斷：</u> {{ result[zone]["診斷"] }}<br>
                ✅ <u>比對結果：</u> {{ compare[zone] }}<br>
                📖 理論：{{ result[zone]["理論"] }}<br>
                💡 建議：{{ result[zone]["建議"] }}
            </div>
        {% endfor %}
    {% endif %}

    <script>
        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const output = document.getElementById('preview');
                output.src = reader.result;
                output.style.display = 'block';
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>
</body>
</html>
